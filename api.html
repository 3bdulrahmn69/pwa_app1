<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API</title>
  <link rel="stylesheet" href="style.css">

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
</head>

<body>
  <div class="container">
    <header>
      <h1>API Data Hub</h1>
      <p class="subtitle">Fetch and explore data from external APIs</p>
    </header>

    <div class="game-container">
      <div class="api-controls">
        <button id="fetchData" class="control-button">🌐 Fetch Posts</button>
        <div class="connection-status" id="connectionStatus">
          <span class="status-indicator online"></span>
          <span class="status-text">Online</span>
        </div>
      </div>

      <div class="loading-spinner" id="loadingSpinner" style="display: none;">
        <div class="spinner"></div>
        <p>Loading data...</p>
      </div>

      <div id="dataContainer" class="data-grid"></div>

      <div class="game-controls">
        <a href="index.html" class="control-button">🏠 Back to Home</a>
      </div>
    </div>
  </div>

  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    // Check online/offline status
    function updateConnectionStatus() {
      const statusIndicator = document.querySelector('.status-indicator');
      const statusText = document.querySelector('.status-text');

      if (navigator.onLine) {
        statusIndicator.className = 'status-indicator online';
        statusText.textContent = 'Online';
      } else {
        statusIndicator.className = 'status-indicator offline';
        statusText.textContent = 'Offline';
      }
    }

    // Listen for online/offline events
    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);

    // Initialize connection status
    document.addEventListener('DOMContentLoaded', () => {
      updateConnectionStatus();
    });

    document.getElementById('fetchData').addEventListener('click', () => {
      const container = document.getElementById('dataContainer');
      const loadingSpinner = document.getElementById('loadingSpinner');

      // Show loading spinner
      loadingSpinner.style.display = 'block';
      container.innerHTML = '';

      fetch('https://jsonplaceholder.typicode.com/posts')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          // Hide loading spinner
          loadingSpinner.style.display = 'none';

          container.innerHTML = '';
          data.slice(0, 20).forEach((post, index) => { // Limit to first 20 posts
            const card = document.createElement('div');
            card.className = 'data-card';
            card.innerHTML = `
              <div class="card-header">
                <span class="post-id">#${post.id}</span>
                <span class="user-id">User ${post.userId}</span>
              </div>
              <h2>${post.title}</h2>
              <p>${post.body}</p>
              <div class="card-footer">
                <small>Post ${index + 1} of ${data.slice(0, 20).length}</small>
              </div>
            `;
            container.appendChild(card);
          });

          // Show success message
          if (data.length > 0) {
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.innerHTML = `✅ Successfully loaded ${data.slice(0, 20).length} posts!`;
            container.insertBefore(successMsg, container.firstChild);
          }
        })
        .catch(error => {
          // Hide loading spinner
          loadingSpinner.style.display = 'none';

          console.error('There was a problem with the fetch operation:', error);

          // Show offline message
          container.innerHTML = `
            <div class="offline-message">
              <div class="offline-icon">📡</div>
              <h3>Connection Lost</h3>
              <p>Unable to fetch new data. You're currently offline or the server is unreachable.</p>
              <p>Cached data may be available.</p>
              <button onclick="location.reload()" class="control-button">🔄 Try Again</button>
            </div>
          `;
        });
    });
  </script>
</body>

</html>